#!/usr/bin/env python

import os
import sys
import argparse
import configparser
from pkg_resources import resource_filename

import cpo_pipeline

def main():
    config = configparser.ConfigParser()
    config_file = resource_filename('data', 'config.ini')
    config.read(config_file)
    script_name = os.path.basename(os.path.realpath(sys.argv[0]))
    parser = argparse.ArgumentParser(prog=script_name, description='')
    parser.add_argument('-i', '--input',  dest='input_file',
                        help='Sample ID', required=False)
    parser.add_argument('-o', '--outdir', dest='outdir',
                        help='Output Directory', required=False)
    parser.add_argument('-v', '--version', action='version',
                        version='%(prog)s {}'.format(cpo_pipeline.__version__))
    args = parser.parse_args()

    # cpo_pipeline.pipeline.main(parser, config)
    assembly = cpo_pipeline.assembly.pipeline.main(parser, config)
    cpo_pipeline.typing.pipeline.main(parser, config, assembly)
    cpo_pipeline.resistance.pipeline.main(parser, config, assembly)

if __name__ == '__main__':
   main()
