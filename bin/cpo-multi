#!/bin/bash

USAGE="cpo-multi [-h] -i|--input INPUT -o|--outdir OUTPUT_DIR\n\
\n\
optional arguments:\n\
  -h, --help \t\t\t Show this help message and exit" 

if [[ ( $1 == "--help") ||  $1 == "-h" ]] 
then 
  echo -e "Usage: ${USAGE}"
  exit 0
fi

input=""
outdir=""

while [[ $# -gt 0 ]]
do
  key="$1"
  
  case $key in
    -i|--input)
    # multi-sample input file
    input="$2"
    shift # past argument
    shift # past value
    ;;
    -o|--outdir)
    # output directory
    outdir="$2"
    shift # past argument
    shift # past value
    ;;
  esac
done

COMMENT_REGEX="^#"

while IFS=$'\t' read -a sample; do
    if [[ "${sample[0]}" =~ $COMMENT_REGEX ]]; then
	continue
    else
	cpo-pipeline -i "${sample[0]}" -1 "${sample[1]}" -2 "${sample[2]}" -o "${outdir}" &
    fi
done < "${input}"
